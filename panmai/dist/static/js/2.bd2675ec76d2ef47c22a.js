webpackJsonp([2],{QXW3:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("3cXf"),o=s.n(a),n={name:"HelloWorld",data:function(){return{percentage:0,id:null,socketStatus:0,message:"",chatList:[],logList:[{userName:13,log:"13123"}],isShowLog:!1,showNews:""}},sockets:{chatMessage:function(e){},message:function(e){var t=(e=JSON.parse(e)).token==localStorage.token;switch(e.type){case"chat":this.chatList.push({msg:e.msg,self:t,userName:t?"我":e.userName,time:e.cre});break;case"getMessage":this.chatList=e.list;break;case"log":this.showNews=e.userName+": "+e.log,this.logList.push({log:e.log,self:t,userName:e.userName});break;case"getlog":this.logList=e.list}console.log("message",e)},percentage:function(e){this.percentage=JSON.parse(e).percentage},broadcast:function(e){console.log("broadcast",e)}},watch:{chatList:function(e){var t=this;this.$nextTick(function(){var e=t.$refs.chatList.children;e[e.length-1].scrollIntoView()})},logList:function(){}},mounted:function(){console.log(this.$refs.sendMessage);var e=this;document.querySelector(".el-input__inner").addEventListener("keydown",function(t){13==t.keyCode&&e.send()}),this.$socket.send(o()({type:"getMessage",limit:20,currentPage:1,userName:localStorage.userName,passWord:localStorage.passWord,unit:localStorage.unit,token:localStorage.token})),this.$socket.send(o()({type:"getlog",limit:20,currentPage:1,userName:localStorage.userName,passWord:localStorage.passWord,unit:localStorage.unit,token:localStorage.token}))},methods:{send:function(){if(""!=this.message){if(!localStorage.token)return this.$message({type:"warning",message:"请重新登陆"}),this.$router.push("/login");var e={type:"chat",userName:localStorage.userName,passWord:localStorage.passWord,unit:localStorage.unit,msg:this.message,token:localStorage.token};this.$socket.send(o()(e)),this.message=""}},setTime:function(){this.$socket.emit("percentage",o()({total:100}))}}},i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",{staticClass:"index"},[s("el-main",{staticClass:"main",attrs:{span:12}},[s("el-scrollbar",{staticStyle:{height:"100%","padding-bottom":"30px"}},[s("ul",{ref:"chatList"},e._l(e.chatList,function(t,a){return s("li",{key:a,class:{left:!t.self,right:t.self}},[s("span",[s("span",[e._v(e._s(t.userName)+":")]),e._v(" "),s("span",[e._v(e._s(t.msg))])])])}),0)]),e._v(" "),s("transition",{attrs:{name:"fade"}},[e.isShowLog?s("el-col",{staticClass:"logs",attrs:{span:6}},[s("el-scrollbar",{staticStyle:{height:"100%","padding-bottom":"30px"}},[s("ul",{ref:"logList"},[s("span",{staticStyle:{float:"right","font-size":"24px","margin-right":"10px"},on:{click:function(t){e.isShowLog=!1}}},[e._v("×")]),e._v(" "),e._l(e.logList,function(t,a){return s("li",{key:a},[s("span",[s("span",[e._v(e._s(t.userName)+":")]),e._v(" "),s("span",[e._v(e._s(t.log))])])])})],2)])],1):e._e()],1),e._v(" "),s("div",{staticClass:"showNews",on:{click:function(t){e.isShowLog=!e.isShowLog}}},[s("span",[e._v(e._s(e.showNews))]),e._v(" "),s("a",[e._v("查看详情")])])],1),e._v(" "),s("el-footer",{staticClass:"footer"},[s("el-input",{ref:"sendMessage",staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}},[s("el-button",{attrs:{slot:"append"},on:{click:e.send},slot:"append"},[e._v("发送")])],1)],1)],1)},staticRenderFns:[]};var l=s("C7Lr")(n,i,!1,function(e){s("eDOd")},"data-v-2e6dafe2",null);t.default=l.exports},eDOd:function(e,t){}});