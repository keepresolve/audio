<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>Document</title>
</head>
<style>
*{
	padding:0;
	margin:0;
	cursor: pointer
}
body,html{
  height: 100%;
	background-color: black;
}

	.pro{
		width:300px;
		height:10px;
		border:5px double #22393F;
		margin:10px 0px;
		margin:0 auto;
		box-shadow:0px 10px 100px #210E4E;
		box-shadow:0px -10px 100px #210E4E;

	}
	.progress{
		width:0px;
		height:10px;
		background-color:#7454F8;
	}
	.big{
		width: 400px;
     	margin: 100px auto;
     	background:lightblue;
     	text-align:center;
     	border:10px groove blue;
     	padding:10px;
     	box-shadow:0px 10px 200px blue;
     	box-shadow:0px -10px 200px blue;
	}
	ul li {
		font:400 14px 微软雅黑;
		list-style-type: none;
		text-shadow:0px 3px 50px black;
		text-shadow:0px -3px 50px black;
		color: gray;
	}
	ul li:hover{
		background-color:blue;
		color: pink;
	}
	ul li div{
		float: right;
		display: none;
	}
	button{
		background:#04272F;
		color:#8CCDDC;
		padding:10px;
		margin-bottom:5px;
	}
	.font{
		color: white;
		width: 300px;
		margin:0 auto;
		text-align: center;
		margin-top: -80px;
		height: 20px;
    overflow: hidden;
   position: relative;

	}.font div{
		width: 300px;
		position:absolute;
		 height:300px;
	}
  .timer{
    width:100px;
    margin: 0 auto;
    font:400 12px 微软雅黑;
  }
  .upfile{
    width:100px;
    overflow: hidden;
    position:relative;
    height:30px;
    margin: 30px auto;
    border:1px solid blue;
    line-height:30px;
    text-align: center;
    color:#fff;
    border-radius:2px;
    font-size: 12px;
  }
  .upfile:hover{
    box-shadow:0px 2px 3px blue;
  }
  .upfile input{
    position: absolute;
    top:0px;
    left:0px;
    width: 100px;
    height: 30px;
    opacity:0;
  }
  pre{
    border:1px solid red;
    color:#fff;
    height:300px;
    overflow: auto;
  }

</style>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<script>
	$(function(){
		// 减少上一曲下一曲的bug
      var ado=document.getElementsByTagName('audio')[0]
     function currentPlay(index){  
          
         $(".showList li").eq(index).find("div").css("display","block")
         $("audio").attr("src",$(".showList li").eq(index).attr("src"))
         // if(ado.src==""||ado.src==".mp3"){
         //       ado.src="千千阙歌.mp3"
         //  }
         $("audio").get(0).play()
     }
     $("ul").on("click","li",function(){
       // 动态小图
         $("ul li div").css("display","none")
         $(this).find("div").css("display","block")
      // 点击歌曲换歌
         $("audio").attr("src",$(this).attr("src"))
         $("audio").get(0).play()
     })
     // 双击播放
     $("h3").dblclick(function(){
     	$("audio").get(0).load()
     	$("audio").get(0).play()
     })
      // 播放
     $(".big button").eq(0).click(function(){
      $("audio").get(0).play()
     })
     // 暂停
        $(".big button").eq(1).click(function(){
     	$("audio").get(0).pause()
     })
        // 快进
       $(".big button").eq(2).mousedown(function(){
     	$("audio").get(0).currentTime+=5;
     })
       // 快退
       $(".big button").eq(3).mousedown(function(){
     	$("audio").get(0).currentTime-=5;
     })
       // 音量加
       $(".big button").eq(4).mousedown(function(){
     	$("audio").get(0).volume+=.1;
     })
       // 音量减
         $(".big button").eq(5).mousedown(function(){
     	$("audio").get(0).volume-=.1;
     })
         //静音
         $(".big button").eq(6).mousedown(function(){
     	$("audio").get(0).muted=!$("audio").get(0).muted;
     })
         //全屏
       $(".big button").eq(7).mousedown(function(){
    if( $(".big").width()-0>400){
          $(".big").animate({
          marginTop:"100px",
           width:"400px",
           height:"60%"
      },function(){
          $(".big button").eq(7).html("全屏")
      })
    }else{
          $(".big").animate({
          marginTop:"0px",
           width:"80%",
           height:"80%"
      },function(){
          $("button").eq(7).html("缩小")
      })
    }
  
     })
     // 下一曲
       $("button").eq(9).mousedown(function(){
       	var str=null;
            $(".showList li").each(function(i){
            	if($(this).attr("src")==$("audio").attr("src")){
                 currentPlay($(this).attr("index")-0+1)
            	}
            })
       
     })
          
         // 上一曲
      $("button").eq(8).mousedown(function(){
       	var str=null;
            $("ul li").each(function(){
            	if($(this).text()+".mp3"==$("audio").attr("src")){
            		  str=$(this).prev().text()+".mp3"
            	}
            })
         $("audio").attr("src",str)
         if(ado.src==""||ado.src==".mp3"){
      	  ado.src="雨的印记.mp3"
        }
         $("audio").get(0).play()
     })
         // 单曲
      $("button").eq(10).mousedown(function(){
     	$("audio").attr("loop","loop")
     })
      // 顺序
        $("button").eq(11).mousedown(function(){
     	$("audio").removeAttr("loop")
        $("audio").get(0).onended=function(){
        	var str=null;
        	  $("ul li").each(function(){
        	  	 if($("audio").attr("src")==$(this).text()+".mp3"){
                      str=$(this).next().text()+".mp3"
        	  	 }
        	  })
        	 $("audio").attr("src",str)
        	 $("audio").get(0).play()
        }
     })
         // 随机
        $("button").eq(12).mousedown(function(){
     	  $("audio").get(0).onended=function(){
     	  	 var index=Math.ceil(Math.random()*4)
     	     var str=$("ul li").eq(index).text()+".mp3"
             $("audio").attr("src",str)
     	  $("audio").get(0).play()
     	  }   	   
     })
        // 循环
         $("button").eq(13).mousedown(function(){
             $("audio").removeAttr("loop")
          $("audio").get(0).onended=function(){
        	var str=null;
        	  $("ul li").each(function(){
        	  	 if($("audio").attr("src")==$(this).text()+".mp3"){
                      str=$(this).next().text()+".mp3"
        	  	 }
        	  })
        	  if(str==null||str==".mp3"){
        	  	str="千千阙歌.mp3"
        	  }
        	 $("audio").attr("src",str)
        	 $("audio").get(0).play()
        }

         })
         //滚动条
        $("audio").get(0).ontimeupdate=function(){
        	var num=$("audio").get(0).currentTime/$("audio").get(0).duration
         $(".progress").get(0).style.width=300*num+"px"
         $(".font div").get(0).style.top=-300*num+"px"
          // 显示时间
          var minute=parseInt($("audio").get(0).currentTime/60)
          var ss=parseInt($("audio").get(0).currentTime%60)
            $(".timer span").eq(1).html(minute)
            $(".timer span").eq(2).html(ss)
        }
        $(".pro").click(function(e){
        	 $("audio").get(0).currentTime=e.offsetX/300*$("audio").get(0).duration
        })

      //上传文件mp3
      $("#upfile").change(function(e){
          var formData = new FormData();
          console.log($('#upfile'))
          formData.append('file/upload', $('#upfile')[0].files[0]);
          $.ajax({
              url: '/file/upload',
              type: 'POST',
              cache: false,
              data: formData,
              processData: false,
              contentType: false
          }).done(function(res) {
             if(res.code==200){
              console.log({res})
                $("pre").html(res.files)
                getInitSrc()
             }
          }).fail(function(err) {
            console.log({err})
          });
      })
      $("#getfileSrc").click(function(){
            getInitSrc()
      })
       getInitSrc()
      function getInitSrc(){
            $.get("/file/getfileSrc",function(res){
            var html=''
               for (var i = res.length - 1; i >= 0; i--) {
                   if(res[i].slice(-3)!=="mp3") continue
                    html+='<li  index="'+i+'" isplay="false" src="'+res[i].slice(6)+'">'+res[i].slice(11,-4)+'<div><img src="play.gif" alt=""></div></li>'
               };
            $(".showList").html(html)
        })
      }
}) 
</script>
<body>

<div class="big"> 
<h3>双击播放</h3>
<ul class="showList">
	<li>千千阙歌<div><img src="play.gif" alt=""></div></li>
	<li>夜的钢琴曲<div><img src="play.gif" alt=""></div></li>
	<li>小苹果<div><img src="play.gif" alt=""></div></li>
	<li>时间都去哪儿了<div><img src="play.gif" alt=""></div></li>
	<li>雨的印记<div><img src="play.gif" alt=""></div></li>
</ul>
<div class="pro">
	<div class="progress"></div>
</div>
<div class="timer"><span>0</span>时<span>0</span>分钟<span>0</span>秒</div>
<audio src="千千阙歌.mp3"></audio>
<div>
<button>播放</button>
<button>暂停</button>
<button>快进</button>
<button>快退</button>
</div>
<div>
<button>音量+</button>
<button>音量-</button>
<button>静音</button>
<button>全屏</button>
</div>
<div>
<button>上一曲</button>
<button>下一曲</button>
<button>單曲</button>
<button>順序</button>
<button>隨機</button>
<button>循環</button>
</div>
</div>
<!-- <div style="clear:both;"></div> -->
<div class="font">
   <div>
   <p>落花不是维萨多啊实打实的阿萨德的所</p>
   <p>阿萨德撒的撒大所大所多阿萨德撒的撒多</p>
   <p>阿萨德撒套票多</p>
   <p>阿萨德撒的撒大所橱柜多</p>
   <p>阿萨德wsz撒的撒asd大所橱柜多</p>
   <p>阿萨德撒的we撒大所橱柜多</p>
   <p>阿萨德撒的撒asd大所橱柜多</p>
   <p>阿萨德撒的das撒大所橱柜多</p>
   <p>阿萨德撒的das撒大所橱柜多</p>
   <p>阿萨德撒的das撒大所橱柜多</p>
   <p>阿萨德撒的das撒大所橱柜多</p>
   <p>阿萨德撒的das撒大所橱柜多</p>
   </div>
</div>

<div class="upfile">
   点击上传MP3
  <input type="file" id="upfile" >
</div>
<div>
  <button id="getfileSrc">获取列表</button>
   <ul>
    
   </ul>
</div>
<div >
  <pre >
    
  </pre>
</div>
</body>
</html>